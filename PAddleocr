# -*- coding: utf-8 -*-
"""Copy of PaddleOCRDemo.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1uSbBIE9s3dhGRG5cLcYGRayr4SZ8O2pP
"""

!python3 -m pip install paddlepaddle-gpu

!pip install "paddleocr>=2.0.1"

from paddleocr import PaddleOCR,draw_ocr
# Paddleocr supports Chinese, English, French, German, Korean and Japanese.
# You can set the parameter `lang` as `ch`, `en`, `fr`, `german`, `korean`, `japan`
# to switch the language model in order.
ocr = PaddleOCR(use_angle_cls=True, lang='en') # need to run only once to download and load model into memory

from google.colab.patches import cv2_imshow
import cv2

from google.colab import drive
drive.mount('/content/drive')

img_path = '/content/drive/MyDrive/00.jpg'

img = cv2.imread(img_path, cv2.IMREAD_UNCHANGED)
cv2_imshow(img)

result = ocr.ocr(img_path, cls=True)
for line in result:
    print(line)

# draw result
from PIL import Image, ImageDraw, ImageFont
image = Image.open(img_path).convert('RGB')

boxes = [line[0] for line in result]
txts = [line[1][0] for line in result]
scores = [line[1][1] for line in result]
font = ImageFont.load_default()
im_show = draw_ocr(image, boxes, txts, scores,font_path='/usr/share/fonts/truetype/humor-sans/Humor-Sans.ttf' )
im_show = Image.fromarray(im_show)
im_show.save('result.jpg')

img = cv2.imread('/content/result.jpg', cv2.IMREAD_UNCHANGED)
cv2_imshow(img)

img_path1='/content/HWLetter.png'
img = cv2.imread(img_path1, cv2.IMREAD_UNCHANGED)
cv2_imshow(img)

result1 = ocr.ocr(img_path1, cls=True)
for line in result1:
    print(line)

image = Image.open(img_path1).convert('RGB')

boxes = [line[0] for line in result1]
txts = [line[1][0] for line in result1]
scores = [line[1][1] for line in result1]
font = ImageFont.load_default()
im_show = draw_ocr(image, boxes, txts, scores,font_path='/usr/share/fonts/truetype/humor-sans/Humor-Sans.ttf' )
im_show = Image.fromarray(im_show)
im_show.save('result1.jpg')

img = cv2.imread('/content/result1.jpg', cv2.IMREAD_UNCHANGED)
cv2_imshow(img)

img_path2='/content/Invoice3.png'
img = cv2.imread(img_path2, cv2.IMREAD_UNCHANGED)
cv2_imshow(img)

result = ocr.ocr(img_path2, cls=True)
for line in result:
    print(line)

image = Image.open(img_path2).convert('RGB')

boxes = [line[0] for line in result]
txts = [line[1][0] for line in result]
scores = [line[1][1] for line in result]
font = ImageFont.load_default()
im_show = draw_ocr(image, boxes, txts, scores,font_path='/usr/share/fonts/truetype/humor-sans/Humor-Sans.ttf' )
im_show = Image.fromarray(im_show)
im_show.save('result2.jpg')

img = cv2.imread('/content/result2.jpg', cv2.IMREAD_UNCHANGED)
cv2_imshow(img)

img_path3='/content/HWImage.jpg'
img = cv2.imread(img_path3, cv2.IMREAD_UNCHANGED)
cv2_imshow(img)

result3 = ocr.ocr(img_path3, cls=True)
for line in result3:
    print(line)

image = Image.open(img_path3).convert('RGB')

boxes = [line[0] for line in result3]
txts = [line[1][0] for line in result3]
scores = [line[1][1] for line in result3]
font = ImageFont.load_default()
im_show = draw_ocr(image, boxes, txts, scores,font_path='/usr/share/fonts/truetype/humor-sans/Humor-Sans.ttf' )
im_show = Image.fromarray(im_show)
im_show.save('result3.jpg')

img = cv2.imread('/content/result3.jpg', cv2.IMREAD_UNCHANGED)
cv2_imshow(img)





# Commented out IPython magic to ensure Python compatibility.
from paddleocr import PaddleOCR,draw_ocr
import os
import cv2
import matplotlib.pyplot as plt
# %matplotlib inline
ocr = PaddleOCR(use_angle_cls=True)

img_path = '/content/drive/MyDrive/images.jpg'
result = ocr.ocr(img_path)

cv2_imshow(result)

def save_ocr(img_path, out_path, result, font):
  save_path = os.path.join(out_path, img_path.split('/')[-1] + 'output')

 

  image = cv2.imread(img_path)

 

  boxes = [line[0] for line in result]

  txts = [line[1][0] for line in result]

  scores = [line[1][1] for line in result]

 

  im_show = draw_ocr(image, boxes, txts, scores, font_path=font)

  

  cv2.imwrite(save_path, im_show)

  img = cv2.cvtColor(im_show, cv2.COLOR_BGR2RGB)
  plt.imshow(img)

# Commented out IPython magic to ensure Python compatibility.
import os

import cv2

import matplotlib.pyplot as plt

# %matplotlib inline

# Specifying output path and font path.

out_path = '/content/drive/MyDrive'

font = './simfang.ttf'

save_ocr(img_path, '/content/drive/MyDrive//', result, font)















